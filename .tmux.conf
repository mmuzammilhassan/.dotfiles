# -----------------------------------------------------------------------------
#       TRY NOT TO STRAY FROM DEFAULTS
#   THE STRONGEST DEVS DONâ€™T PICK SIDES â€” THEY PICK TOOLS.
#   â€œPICK ONE POWERFUL TOOL, MASTER IT, AND BUILD THINGS THAT MATTER.â€
# -----------------------------------------------------------------------------

# ============================================
#       GENERAL CONFIGURATION
# ============================================

set -g prefix `                 # Prefix: Backtick (`)
bind ` send-prefix              # Press ` twice to send actual backtick
set -g base-index 1             # Start windows at 1
set -g pane-base-index 1        # Start panes at 1
set -g renumber-windows on      # Renumber when a window closes
set -g escape-time 0            # Remove delay for Vim/Neovim
set -g history-limit 1000000    # Massive history
set -g set-clipboard on         # System clipboard integration
set -g detach-on-destroy off    # Switch to prev session instead of detaching
set -g focus-events on          # Vital for Neovim 'autoread'
set -g mouse on                 # Enable mouse support

# TrueColor & Cursor Shape Fixes (Neovim Support)
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color*:Tc"
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # Undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m' # Underscore colors
# set -g default-terminal "xterm-256color"
# set -g -a terminal-overrides ",xterm*:Tc" # True color support

# =======================
#       KEY BINDINGS
# =======================
unbind C-b                 # Unbind default prefix
unbind r                   # Reload config
#bind r source-file ~/.tmux.conf \; display "Reloaded!"
bind r source-file ~/.tmux.conf;

# -- Window & Pane Management --
bind x kill-pane           # Kill current pane
bind -n M-b last-window    # default key is prefix-;
#default copy-mode key is prefix-[
#default key is prefix-p, prefix-n
#bind M-l last-window # default key prefix-l
#bind-key l last-window
# default swap-pane is prefix-{
#bind -n M-i swap-window -t -1   # Move window left
#bind -n M-r swap-window -t +1   # Move window right

# Split windows (with current path)
bind "'" split-window -v -c "#{pane_current_path}" # Split Vertical
bind "." split-window -h -c "#{pane_current_path}" # Split Horizontal

# -- Vim-style Pane Navigation --
bind -r k select-pane -U
bind -r j select-pane -D
bind -r h select-pane -L
bind -r l select-pane -R
#bind -r ^ last-window

# Vi copy mode
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
# bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
# this C-v is works when you first press v, and then C-v so this line no needed.
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# -- Resizing --
bind -r UP resize-pane -U +5
bind -r DOWN resize-pane -D +5
bind -r LEFT resize-pane -L +10
bind -r RIGHT resize-pane -R +10

# tmux popups
# Key Options
# -E: Automatically closes the popup once the command exits.
# -w / -h: Set the width and height (can be a percentage, e.g., -w 80% -h 80%).
# -x / -y: Set the horizontal and vertical position. Use C for center (e.g., -xC -yC).
# -d: Specify the starting working directory.
# -T: Sets a title for the popup window. 

# display-popup -E -w 80% -h 75% "echo 'Your help text here' | less"
# Example .tmux.conf binding for a persistent shell popup

# Prefix + M: Fast, lightweight math (calc).
# Prefix + L: Git management for your current project (pane_current_path).
# Prefix + D: Git management specifically for your config files ($HOME/.dotfiles).
# Prefix + C: A quick project shell for Composer/Artisan commands.

# Open calc in a centered 90% size popup
bind-key M display-popup -xC -yC -w 50% -h 70% calc

# Open lazygit in a centered 90% size popup
bind-key L display-popup -E -d "#{pane_current_path}" -xC -yC -w 90% -h 90% lazygit

# Open for .dotfiles
# Open lazygit for your dotfiles from any session
# bind-key D display-popup -E -d "$HOME/.dotfiles" -xC -yC -w 80% -h 70% "lazygit"

bind-key D display-popup -E -d "$HOME/.dotfiles" -xC -yC -w 80% -h 70% 

# Open for artisan/composer in a centered 90% size popup
bind-key C display-popup -E -d "#{pane_current_path}" -xC -yC -w 80% -h 70% 

# vim like keybinds for resize-pane
#bind -r k resize-pane -U +5
#bind -r j resize-pane -D +5
#bind -r h resize-pane -L +10
#bind -r l resize-pane -R +10

# ============================================
#       SESSION WORKFLOW ("Harpoon")
# ============================================
# New/Find Sessions
bind g new-session 
bind -n C-f command-prompt -p "Find session:" "switch-client -t '%%'" # search with numbers
bind -n M-w switch-client -l

#CHATGPT ROCKS THIS TIME
# C-f â†’ fuzzy finder (pick folder, go to session)
bind-key -r M-f run-shell "~/.local/bin/tmux-sessionizer"

# Save Current Session to Slot (M-g)
bind-key -n M-g command-prompt -p "Assign session to slot (h/t/n/s):" "run-shell 'echo \"#{session_name}\" > ~/.tmux-session-slot-%%'"

# Jump to saved session slots (dynamically assigned)
bind-key -n M-h run-shell 'tmux switch-client -t $(cat ~/.tmux-session-slot-h 2>/dev/null || echo NO_SESSION)'
bind-key -n M-t run-shell 'tmux switch-client -t $(cat ~/.tmux-session-slot-t 2>/dev/null || echo NO_SESSION)'
bind-key -n M-n run-shell 'tmux switch-client -t $(cat ~/.tmux-session-slot-n 2>/dev/null || echo NO_SESSION)'
bind-key -n M-s run-shell 'tmux switch-client -t $(cat ~/.tmux-session-slot-s 2>/dev/null || echo NO_SESSION)'

# ============================================
#       CHEATSHEET
# ============================================
#  Key           Action                        
# ============================================
# `C-f` | search session
# `M-f` | Fuzzy find a project â†’ open session
# `M-g` | Save current session to a letter slot
# `M-h` | Jump to saved session in slot `h`
# `M-t` | Jump to slot `t`, etc.
# `M-w` | switch-client.
# ============================================
# default next/previous session keybind is prefix+( )
# You can extend it with more slots like M-a, M-e, etc. 
# Just copy the pattern.


# ============================================
#       VISUAL STYLING (Rose Pine)
# ============================================
# BORDERS
# single, double, heavy, simple, number
set -g pane-border-lines heavy
set -g pane-active-border-style 'fg=#9ccfd8,bg=default'
set -g pane-border-style 'fg=#9ccfd8,bg=default'

#set -g pane-active-border-style 'fg=colour51,bg=default'
#set -g pane-border-style 'fg=colour235,bg=default'
# set -g pane-border-style 'fg=colour235,bg=default'
# set -g pane-active-border-style 'fg=colour51,bg=default'
#set -g pane-active-border-style 'fg=white,bg=default'
#set -g pane-border-style 'fg=white,bg=default'

# STATUS BAR STYLING
# LIGHT THEME
#set -g status-style bg='#fffaf3',fg='#797592'

# DARK THEME
#set -g status-style bg='#2a273f',fg='#908caa'
set -g status-style bg='#1f1d2e',fg='#908caa'
#set -g status-style bg='#1f1d2e',fg='#ea6f91'
#set -g status-style fg='#ea6f91'
#set -g status-style bg='#2a273f',fg='#f2e984'

# INACTIVE WINDOW STYLE
# 1. THE TEXT (The Format)
# This defines what is actually written on the screen.
# set -g window-status-format "#I:#W"
# set -g window-status-current-format "#I:#W*"

# 2. THE COLORS (The Style)
# This defines the colors for the text above.

# # Inactive windows (Pink text on dark background)
# set -g window-status-style "fg=#ea6f91,bg=#1f1d2e"
#
# # Active/Current window (Yellow text on dark background)
# set -g window-status-current-style "fg=#f1e883,bg=#1f1d2e"

# SET STATUS-RIGHT WITH CUSTOM TEXT
# set -g status-position bottom        # Status bar at top/bottom

# Add the script output to your right status bar
# Adjust the colors (#f39c12 is orange) to match your theme
# set -g status-right "#[fg=#f39c12] #(tmux-task) #[fg=white] | %H:%M "
# Refresh every minute
set -g status-interval 60

# This calls your battery script AND the new task script
 set -g status-right "#[fg=#ea6f92]#[fg=black,bg=#ea6f92]#(~/.local/bin/sb-battery) #[fg=#ea6f92,bg=default] #[fg=#ea6f92]#[fg=black,bg=#ea6f92] #[fg=#ea6f92]#[fg=black,bg=#ea6f92]#(~/.local/bin/sb-internet)#[fg=#ea6f92,bg=default] #[fg=#ea6f92]#[fg=black,bg=#ea6f92] #(~/.local/bin/tmux-scripts/tmux-task) #[fg=#ea6f92,bg=default] #[fg=#ea6f92]#[fg=black,bg=#ea6f92] %H:%M #[fg=#ea6f92,bg=default]"
# set -g status-right " #(~/.local/bin/tmux-scripts/tmux-task)"
#set -g status-right "[zephyr] "
# set -g status-right "#(~/.local/bin/tmux-scripts/pacman-chasing-moonphase)"
#set -g status-right '"#{pane_current_path}"'
set -g status-left "#[fg=#f6c177]#[fg=black,bg=#f6c177] [#S] #[fg=#f6c177,bg=default] "
#set -g status-justify centre

# Put window name in the center
# Pro tip less is more and 5 set the best for now
 set -g status-left-length 20                  # Adjust window name space (if needed)
#set -g status-right-length 35                # Adjust space for right content
#set -g window-status-current "#(tmux display-message -p '#W')"  # Current window name

# Use TrueColor in tmux (requires TERM to support it)
# Enable 256-color mode and TrueColor support
set -g default-terminal "xterm-256color"
set -g terminal-overrides ",xterm-256color*:Tc"
set -as terminal-overrides ',xterm-256color:Ss=\E[%p1%d q:Se=\E[2 q'

# set -g default-terminal "term-256color"
# set -g terminal-overrides ",term-256color*:Tc"

# ============================================
#       PLUGINS
# ============================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
#set -g @plugin 'christoomey/vim-tmux-navigator'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# # Resurrect/continuum settings
# set -g @resurrect-strategy-nvim 'session'
# set -g @resurrect-capture-pane-contents 'on'
# #  Automatically restore tmux state after reboot
# set -g @continuum-restore 'on'
# set -g @continuum-save-interval '5'

#  Bind prefix + a to save the tmux-continuum session and show a message
# bind-key a run-shell '~/.tmux/plugins/tmux-continuum/scripts/continuum_save.sh; tmux display-message "Session-saved! ðŸ˜Š"'
# bind a run-shell '~/.local/bin/tmux-resurrect-save;'

# Initialize TMUX plugin manager (keep this line at the very bottom of your tmux.conf)
#git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
run '~/.tmux/plugins/tpm/tpm'
